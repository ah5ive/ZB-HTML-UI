"use strict";!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):(window.WatchJS=e(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var h={noMore:!1,useDirtyCheck:!1},d=[],w=[],c=[],a=!1;try{a=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(h){}function l(e,t){var n=[],r=[];if("string"!=typeof e&&"string"!=typeof t){if(p(e)&&t)for(var o=0;o<e.length;o++)void 0===t[o]&&n.push(o);else for(var o in e)e.hasOwnProperty(o)&&t&&!t.hasOwnProperty(o)&&n.push(o);if(p(t)&&e)for(var c=0;c<t.length;c++)void 0===e[c]&&r.push(c);else for(var c in t)t.hasOwnProperty(c)&&e&&!e.hasOwnProperty(c)&&r.push(c)}return{added:n,removed:r}}function i(e,t,n,r,o){if("string"!=typeof e&&(e instanceof Object||p(e)))for(var c=0;c<t.length;c++){var a=t[c];s(e,a,n,r,o)}}function s(e,t,n,r,o){"string"==typeof e||!(e instanceof Object||p(e))||u(e[t])||(null!=e[t]&&(void 0===r||0<r)&&j(e[t],n,void 0!==r?r-1:r),S(e,t,n,r),o&&(void 0===r||0<r)&&D(e,t,n,r))}function f(e,t,n){for(var r in t)t.hasOwnProperty(r)&&k(e,t[r],n)}var u=function(e){return e&&"[object Function]"=={}.toString.call(e)},p=function(e){return"[object Array]"===Object.prototype.toString.call(e)},v=function(e){return"[object Object]"==={}.toString.apply(e)},g=function(e){if(null==e||"object"!=typeof e)return e;var t,n=e.constructor();for(t in e)n[t]=e[t];return n},_=function(t,n,r){try{Object.defineProperty(t,n,{enumerable:!1,configurable:!0,writable:!1,value:r})}catch(e){t[n]=r}},b=function(e,t,n){w[w.length]={prop:t,object:e,orig:g(e[t]),callback:n}},j=function(e,t,n,r){if("string"!=typeof e&&(e instanceof Object||p(e))){if(p(e)){if(S(e,"__watchall__",t,n),void 0===n||0<n)for(var o=0;o<e.length;o++)j(e[o],t,n,r)}else{var c=[];for(o in e)"$val"==o||!a&&"watchers"===o||Object.prototype.hasOwnProperty.call(e,o)&&c.push(o);i(e,c,t,n,r)}r&&D(e,"$$watchlengthsubjectroot",t,n)}},t=[],n=null;function e(){n=null;for(var e=0;e<t.length;e++)t[e]();t.length=0}function y(){var e=null;J=null;for(var t=0;t<c.length;t++)e=c[t],W(e.obj,e.prop,e.mode,e.newval,e.oldval);e&&(c=[])}var O=function(){return n=n||setTimeout(e)},P=function(e){null==n&&O(),t[t.length]=e},m=function(c,a,e,t){var l=null,i=-1,s=p(c);j(c,function(e,t,n,r){var o=O();if(i!==o&&(i=o,(l={type:"update"}).value=c,l.splices=null,P(function(){a.call(this,l),l=null})),s&&c===this&&null!==l){if("pop"===t||"shift"===t)n=[],r=[r];else if("push"===t||"unshift"===t)n=[n],r=[];else if("splice"!==t)return;l.splices||(l.splices=[]),l.splices[l.splices.length]={index:e,deleteCount:r?r.length:0,addedCount:n?n.length:0,added:n,deleted:r}}},1==e?void 0:0,t)},S=function(i,s,e,f){var t=!1,n=p(i);i.watchers||(_(i,"watchers",{}),n&&$(i,function(e,t,n,r){if(M(i,e,t,n,r),0!==f&&n&&(v(n)||p(n)))for(var o,c=i.watchers[s],a=(c=(e=i.watchers.__watchall__)?c?c.concat(e):e:c)?c.length:0,l=0;l<a;l++)if("splice"!==t)j(n,c[l],void 0===f?f:f-1);else for(o=0;o<n.length;o++)j(n[o],c[l],void 0===f?f:f-1)})),i.watchers[s]||(i.watchers[s]=[],n)||(t=!0);for(var r=0;r<i.watchers[s].length;r++)if(i.watchers[s][r]===e)return;if(i.watchers[s].push(e),t){var c=i[s],n=function(e,t){var n=c;if(c=e,0!==f&&i[s]&&(v(i[s])||p(i[s]))&&!i[s].watchers)for(var r=i.watchers[s].length,o=0;o<r;o++)j(i[s],i.watchers[s][o],void 0===f?f:f-1);C(i,s)?x(i,s):h.noMore||n!==e&&((t?M:W)(i,s,"set",e,n),h.noMore=!1)};if(h.useDirtyCheck)b(i,s,n);else{var t=i,o=s,a=function(){return c},l=n;try{Object.defineProperty(t,o,{get:a,set:function(e){l.call(this,e,!0)},enumerable:!0,configurable:!0})}catch(e){try{Object.prototype.__defineGetter__.call(t,o,a),Object.prototype.__defineSetter__.call(t,o,function(e){l.call(this,e,!0)})}catch(a){b(t,o,l)}}}}},W=function(e,t,n,r,o){if(void 0!==t)for(var c,a=e.watchers[t],l=(a=(c=e.watchers.__watchall__)?a?a.concat(c):c:a)?a.length:0,i=0;i<l;i++)a[i].call(e,t,n,r,o);else for(var t in e)e.hasOwnProperty(t)&&W(e,t,n,r,o)},o=["pop","push","reverse","shift","sort","slice","unshift","splice"],$=function(e,t){if(u(t)&&e&&!(e instanceof String)&&p(e))for(var n,r=o.length;r--;)!function(c,a,l,i){_(c,l,function(){var e=0;if("splice"===l){for(var t=arguments[0],n=c.slice(t,t+arguments[1]),r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];e=t}else r=0<arguments.length?arguments[0]:void 0;return t=a.apply(c,arguments),"slice"!==l&&("pop"===l?(n=t,e=c.length):"push"===l?e=c.length-1:"shift"===l?n=t:"unshift"!==l&&void 0===r&&(r=t),i.call(c,e,l,r,n)),t})}(e,e[n=o[r]],n,t)},k=function(e,t,n){if(t){if(e.watchers[t])if(void 0===n)delete e.watchers[t];else for(var r=0;r<e.watchers[t].length;r++)e.watchers[t][r]==n&&e.watchers[t].splice(r,1)}else delete e.watchers;for(var o=e,c=t,a=n,l=0;l<d.length;l++){var i=d[l];i.obj!=o||c&&i.prop!=c||a&&i.watcher!=a||d.splice(l--,1)}for(var s=e,f=t,h=0;h<w.length;h++){var u=w[h],p=u.object.watchers;u.object!=s||f&&u.prop!=f||!p||f&&p[f]&&0!=p[f].length||w.splice(h--,1)}},C=function(e,t){return e.watchers&&(e.watchers.__wjs_suspend__||e.watchers["__wjs_suspend__"+t])},x=function(e,t){P(function(){delete e.watchers.__wjs_suspend__,delete e.watchers["__wjs_suspend__"+t]})},J=null,M=function(e,t,n,r,o){c[c.length]={obj:e,prop:t,mode:n,newval:r,oldval:o},null===J&&(J=setTimeout(y))},D=function(e,t,n,r){var o=g("$$watchlengthsubjectroot"===t?e:e[t]);d.push({obj:e,prop:t,actual:o,watcher:n,level:r})};return setInterval(function(){for(var e,t,n=0;n<d.length;n++){var r,o=d[n];if("$$watchlengthsubjectroot"===o.prop)((r=l(o.obj,o.actual)).added.length||r.removed.length)&&(r.added.length&&i(o.obj,r.added,o.watcher,o.level-1,!0),o.watcher.call(o.obj,"root","differentattr",r,o.actual)),o.actual=g(o.obj);else{if((r=l(o.obj[o.prop],o.actual)).added.length||r.removed.length){if(r.added.length)for(var c=0;c<o.obj.watchers[o.prop].length;c++)i(o.obj[o.prop],r.added,o.obj.watchers[o.prop][c],o.level-1,!0);W(o.obj,o.prop,"differentattr",r,o.actual)}o.actual=g(o.obj[o.prop])}}if(0<w.length)for(n=0;n<w.length;n++)t=(e=w[n]).object[e.prop],function(e,t){var n,r=!0;if(e!==t)if(v(e)){for(n in e)if((a||"watchers"!==n)&&e[n]!==t[n]){r=!1;break}}else r=!1;return r}(e.orig,t)||(e.orig=g(t),e.callback(t))},50),h.watch=function(){(u(arguments[1])?j:p(arguments[1])?i:s).apply(this,arguments)},h.unwatch=function(){(u(arguments[1])?function(e,r){if(!(e instanceof String)&&(e instanceof Object||p(e)))if(p(e)){for(var t=["__watchall__"],n=0;n<e.length;n++)t.push(n);f(e,t,r)}else{var o=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&(e[t]instanceof Object?o(e[t]):n.push(t));f(e,n,r)};o(e)}}:p(arguments[1])?f:k).apply(this,arguments)},h.callWatchers=W,h.suspend=function(e,t){e.watchers&&(e.watchers["__wjs_suspend__"+(void 0!==t?t:"")]=!0)},h.onChange=function(){(u(arguments[2])?function(e,t,c,a,l){e&&t&&(s(e,t,function(e,t,n,r){var o={type:"update"};o.value=n,o.oldvalue=r,(a&&v(n)||p(n))&&m(n,c,a,l),c.call(this,o)},0),a&&v(e[t])||p(e[t]))&&m(e[t],c,a,l)}:m).apply(this,arguments)},h});